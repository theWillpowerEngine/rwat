<!DOCTYPE html>
<html>
  <head>
    <title>Riven World:  Airship Trader</title>
    <script>window.$ = window.jQuery = require('./stuff/jquery.js');</script>
    <script src="./stuff/rot.js"></script>
    <script src="./stuff/keys.js"></script>
    <style>
        body{
            padding: 0 0 0 0;
            margin: 0 0 0 0;
            overflow: hidden;
            background-color: rgb(1, 82, 82);
        }

        #header {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 25px;
          background-color: red;
          -webkit-app-region: drag;  
        }

        #sidebar {
          position: absolute;
          right: 0;
          top: 25px;
          bottom: 25px;
          width: 200px;
          background-color: blueviolet;
        }
      
        #footer {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          height: 25px;
          background-color: red;
        }

        #game {
          position: absolute;
          top: 25px;
          bottom: 25px;
          left: 0;
          right: 200px;
        }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="header"> </div>
      <div id="game"> </div>
      <div id="sidebar"> </div>
      <div id="footer"> </div>
    </div>


    <script>
      const { ipcRenderer } = require("electron")
      const makeEngine = require("./src/engine.js")
      const getCursorPosition = (canvas, event) => {
        const rect = canvas.getBoundingClientRect()
        const x = event.clientX - rect.left
        const y = event.clientY - rect.top
        return {x, y}
      }

      window.onerror = function(msg, url, line, col, error) {
        var extra = !col ? '' : '\ncolumn: ' + col;
        extra += !error ? '' : '\nerror: ' + error;

        var suppressErrorAlert = false;
        ipcRenderer.invoke("showDev")
        return suppressErrorAlert;
      };

      const engine = makeEngine(msg => {
        console.log(msg)
      })

      $(() => {
        engine.init((step, msg) => {
          console.log(`Step ${step} done: ${msg}.`)
        })
        engine.render()

        $("canvas").on('mousedown', e => {
          var coords = getCursorPosition(e.target, e)
          coords.x = Math.trunc(coords.x /= 20)
          coords.y = Math.trunc(coords.y /= 20)
          console.log(engine.renderer.getTileAt(coords.x, coords.y).desc)
        })
      })
    </script>
  </body>
</html>